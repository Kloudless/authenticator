# Kloudless Authenticator with Vue

Kloudless Authenticator for your Vue App. We provide:

- `AuthButton`:
  a button component that will launch the Authenticator when clicked
- `createAuthButton`:
  a HOC method that wraps your custom component to launch the Authenticator

Support Vue v2.

<!-- STORY -->

<!-- STORY HIDE START -->

[DEMO](https://kloudless.github.io/authenticator/vue)

<!-- STORY HIDE END -->

## Table of contents

* [Installation](#installation)
* [Usage](#usage)
  * [Use AuthButton](#use-authbutton)
  * [Use createAuthButton](#use-createauthbutton)
    * [Example](#example)
* [Props](#props)
* [Attributes](#attributes)
* [Events](#events)
* [Set/Get global options](#setget-global-options)
* [Testing](#testing)

## Installation

```shell
npm install @kloudless/authenticator
```

## Usage

### Use AuthButton

A button component that wraps the [Authenticator](https://github.com/Kloudless/authenticator)
view and will launch the Authenticator when clicked.

```html
<template>
  <auth-button
    :options="{ 'client_id': 'KLOUDLESS_APP_ID' }"
    class="CUSTOM_CLASS"
    disabled="false"
    title="BUTTON_TITLE"
    @click="onClick"
    @error="onError"
    @success="onSuccess" >
  </auth-button>
</template>
 
<script>
import { AuthButton } from '@kloudless/authenticator/vue';

export default {
  components: { AuthButton },
  methods: {
    onClick() { console.log('click'); },
    onSuccess(result) { console.log('success', result) },
    onError(error) { console.log('error', error) }
  }
};
</script> 
```

### Use createAuthButton

A HOC method wraps your custom component to launch the Authenticator.  
It will add a transparent component layer that will catch the click event from
the wrapped component and then launch the Authenticator.

All the properties except `options` passed to the HOC component will be passed
to the wrapped component.  
Also, all the events emitted from the wrapped component will be propagated.  
In addition, the HOC component will emit these [events](#events) that
are generated by the Authenticator.

A `click` event will be emitted even if the wrapped component doesn't emit one.

#### Example

First, wrap your custom button:
```javascript
import { createAuthButton } from '@kloudless/authenticator/vue';
import CustomButton from 'path/to/CustomButton';

const CustomAuthButton = createAuthButton(CustomButton);

export default CustomAuthButton
```

Usage:
```html
<template>
  <custom-auth-button
    :options="{ 'client_id': 'KLOUDLESS_APP_ID' }"
    @click="onClick"
    @error="onError"
    @success="onSuccess" />
</template>
```

## Props

- `options` _(Required)_  
  OAuth config object.
- `options.client_id` _(Required)_  
  The Kloudless application ID.
- `options.scope`  
  Used to determine which services the user can choose from to connect.
  Could either be an Array of different scopes, or a space-delimited string.  
  ex: `"any.calendar any.storage"`, `["any.calendar", "any.storage"]`
- `options.extra_data`  
  A URL-encoded JSON object containing data used to pre-fill default values for
  fields in the Kloudless authentication forms.
  ex: the domain of a WebDAV server.
- `options.oob_loading_delay`  
  Indicates the number of milliseconds the loading spinner will last on the
  callback page before revealing the token. Defaults to 2000.
- `title`  
  Button title. Defaults to `"Connect Account"`. Only available in `AuthButton`.

## Attributes

Here are useful DOM element attributes that could use in `AuthButton`.

- `style`  
  CSS style
- `class`
  CSS class name
- `disabled`
  `true` to disabled AuthButton

## Events

- `success`  
  Emitted when authentication succeeds. The parameter is an object that contains
  the access token obtained via the OAuth flow, as well as the metadata of the
  [account](https://developers.kloudless.com/docs/latest/authentication#accounts)
  that was connected:
  ```javascript
  {
      'access_token': 'TOKEN123ABC',
      'token_type': 'Bearer',
      'scope': 'box:normal.storage', // Currently, the requested scope is returned
      'state': 'randomstate123',
      'account': {
          'id': 123,
          'service': 'box',
          ...
      }
  }
  ```
- `error`  
  Emitted when authentication fails. The parameter is an object that contains
  error information:
  ```javascript
  {
    'error': "server_error"
    'error_description': "An error occurred. User did not authorize access to account"
    'state': "7691344675"
  }
  ```
- `click`  
  Emitted when the component is clicked.

## Set/Get global options

See [auth.setGlobalOptions()](https://github.com/Kloudless/authenticator#authsetglobaloptions)
and [auth.getGlobalOptions()](https://github.com/Kloudless/authenticator#authgetglobaloptions).

## Testing

First, install dependencies: (Only needs to be done once)
```shell
$ npm install --prefix storybook-vue/
```

Then, start up testing server:
```shell
$ npm run storybook:vue
```

Or you can specify your Kloudless APP ID:

```shell
$ STORYBOOK_KLOUDLESS_APP_ID=APP_ID npm run storybook:vue
```
